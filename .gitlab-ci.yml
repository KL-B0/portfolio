image: node:18-alpine

stages:
  - build
  - preview
  - deploy

build:
    stage: build
    cache:
        key: 
            files:
                - package-lock.json
        paths:
          - node_modules/ 
    artifacts:
        untracked: false
        expire_in: 7 days
        name: "website-$CI_COMMIT_REF_NAME"
        paths:
            - dist/
    script:
        - npm install
        - npm run build

deploy:
    stage: deploy
    needs: ["build"]
    cache:
        key: 
            files:
                - package-lock.json
        paths:
          - node_modules/ 
    script:
        - npm install
        - npx netlify deploy --prod --dir dist/
    rules:
        - if: $CI_COMMIT_BRANCH  =~ /v([0-9]+(\.[0-9]+)+)/